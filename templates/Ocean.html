<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/Ocean.css">
    <title>Ocean Drift Bottles</title>
</head>
<body>
    <!-- Bottle Message Display -->
    <div class="overlay overlay-back"></div>
    <div class="overlay overlay-front">
        <div class="note-text" id="main-note"></div>
    </div>
    <main class="ocean-background">
        <div class="ui-block">
            <!-- Message Display -->
            <div class="message-display">
                <textarea id="message-textbox" placeholder="Enter your message here..."></textarea>
            </div>
            <div class="ui-block-bottom">
                <button id="done-button">Done</button>
                <!-- Buttons -->
                <div class="button-container">
                    <button id="get-button">Get</button>
                    <button id="drop-button">Drop</button>
                    <button id="dropped-bottles-button">Dropped Bottles</button>
                    <div id="drop-message-display" class="drop-reflection-area"></div> <!-- Drop Message Display -->
                </div>
            </div>
        </div>
            <!-- Dropped Bottles History -->
            <div class="dropped-bottles-history">
                <!-- Display dropped bottles and replies here -->
            </div>
    </main>
    <div id = "back-btn">
        <img src="../static/images/lighthouse-svgrepo-com.svg" alt="back button">
    </div>
    <div id="shoreline">
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="../static/Interceptor.js"></script>
<script>

    document.getElementById("get-button").addEventListener("click", function () {
        axios({
            url: '/api/bottlemessages',
            method: 'GET',
        }).then(result => {
            console.log(result.data);
            let message_content = result.data.message_content;
            let bottle = createBottle(message_content);
            shoreline.prepend(bottle);
        }).catch(error => {
            console.error("Error fetching message: ", error);
            let bottle = createBottle("The note is blank...");
            shoreline.appendChild(bottle);
        });
    });

    document.onkeydown = function(e) {
        e = e || window.event;
        if (e.key === "Escape" || e.key === "Esc") {
            toggleoverlay(false)
        }
    }

    function createBottle(message) {
        var bottle = document.createElement("div");
        bottle.classList.add("bottle");
        bottle.innerHTML = "<img src=\"../static/images/bottle.png\" alt=\"bottle\" class=\"bottle-icon\">";

        bottle.addEventListener("click", function() {
            console.log("Bottle clicked with message: ", message);
            displaybottle("main-note", message); 
            toggleoverlay(true);
            bottle.remove();
        });
        return bottle;
    }

    function displaybottle(elementId, message) {
        var bottleBox = document.getElementById(elementId);
        bottleBox.innerText = message;
    }

</script>
<script>
    document.getElementById("drop-button").addEventListener("click", function() {
        var messageContent = document.getElementById("message-textbox").value;
        axios.post('/api/bottlemessages/send', {
            message: messageContent
        }).then(response => {
            console.log(response.data);
            displayMessage("drop-message-display", "Message dropped successfully!", "success");
        }).catch(error => {
            console.error("Error sending message: ", error);
            displayMessage("drop-message-display", "Failed to drop the message.", "error");
        });
    });

    function displayMessage(elementId, message, type) {
        var messageBox = document.getElementById(elementId);
        messageBox.innerText = message;
        messageBox.className = `drop-reflection-area ${type}`;
        messageBox.style.display = "block";
        setTimeout(function() { messageBox.style.display = "none"; }, 1500);
    }

    function toggleoverlay(on) {
        var overlay = document.getElementsByClassName("overlay");
        for (var i = 0; i < overlay.length; i++) {
            overlay[i].style.opacity = on ? '1.0' : '0.0';
            overlay[i].style.pointerEvents = on ? 'all' :'none';
        }
    }
</script>

<script>
    document.getElementById("back-btn").addEventListener("click", function() {
            window.location.href= '/homepage';
    });
</script>

</html>
